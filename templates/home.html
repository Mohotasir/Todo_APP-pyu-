<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="UTF-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link
         href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
         rel="stylesheet"
      />
      <title>To-Do List</title>
   </head>
   <body>
      <div class="container mt-5 ">
         <h1 class="text-center">To-Do List</h1>
         <div class=" d-flex align-items-center justify-content-center">
            <div class="col-6 text-center">
               <form  method="POST" class="mb-3">
                  {% csrf_token %}
                  <div class="input-group">
                     <input
                        required
                        type="text"
                        name="title"
                        class="form-control fs-5"
                        placeholder="Add a new task"
                     />
                     <button type="submit" class="btn btn-primary">Add Task</button>
                  </div>
               </form>
            </div>
         </div>
        

         <div class="d-flex justify-content-between row mt-5">
            <div class="col-6">
               <h5>Remaining Tasks</h5>
               <ul class="list-group">
                  {% for task in remaining_tasks %}
                  <li class="list-group-item d-flex justify-content-between align-items-center justify-content-center gap-3">
                     <div class="d-flex align-items-center">
                        <form method="POST" action="{% url 'mytodo' %}">
                           {% csrf_token %}
                           <input type="hidden" name="task_id" value="{{ task.id }}">
                           <input 
                              type="checkbox" 
                              name="done" 
                              onChange="this.form.submit()">
                        </form>
                        <h6 class="mx-2">{{ task.title }}</h6>
                     </div>
                     <div>
                        <!-- Trigger the modal with the Edit button -->
                        <button type="button" class="badge bg-success" data-bs-toggle="modal" data-bs-target="#editModal{{ task.id }}">
                           Edit
                        </button>

                        <!-- Delete task -->
                        <form method="POST" style="display: inline">
                           {% csrf_token %}
                           <input type="hidden" name="task_id" value="{{ task.id }}" />
                           <button type="submit" name="delete_task" class="badge btn btn-danger">Delete</button>
                        </form>
                         <span class="badge bg-warning">incomplete</span>
                     </div>
                  </li>

                  <!-- Modal for editing the task -->
                  <div class="modal fade" id="editModal{{ task.id }}" tabindex="-1" aria-labelledby="editModalLabel{{ task.id }}" aria-hidden="true">
                     <div class="modal-dialog">
                        <div class="modal-content">
                           <div class="modal-header">
                              <h5 class="modal-title" id="editModalLabel{{ task.id }}">Edit Task</h5>
                              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                           </div>
                           <form method="POST" action="{% url 'update_task' task.id %}">
                              {% csrf_token %}
                              <div class="modal-body">
                                 <input
                                    required
                                    type="text"
                                    name="title"
                                    class="form-control"
                                    value="{{ task.title }}"
                                    placeholder="Update task title"
                                 />
                              </div>
                              <div class="modal-footer">
                                 <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                 <button type="submit" class="btn btn-primary">Update Task</button>
                              </div>
                           </form>
                        </div>
                     </div>
                  </div>
                  {% endfor %}
               </ul>
            </div>
            <div class="col-6">
               <h5>Completed Task</h5>
               <ul class="list-group">
                  {% for task in completed_tasks %}
                  <li class="list-group-item d-flex justify-content-between align-items-center justify-content-center gap-3">
                     <div class="d-flex align-items-center">
                        <h6 class="mx-2">{{ task.title }}</h6>
                     </div>
                     <div>

                        <!-- Delete task -->
                        <form method="POST" style="display: inline">
                           {% csrf_token %}
                           <input type="hidden" name="task_id" value="{{ task.id }}" />
                           <button type="submit" name="delete_task" class="badge btn btn-danger">Delete</button>
                        </form>
                        
                     </div>
                  </li>   
                  {% endfor %}
               </ul>
            </div>
         </div>
      </div>

      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
   </body>
</html>
